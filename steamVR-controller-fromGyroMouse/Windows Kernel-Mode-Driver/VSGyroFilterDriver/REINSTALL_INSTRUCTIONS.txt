ИНСТРУКЦИИ ПО ПЕРЕУСТАНОВКЕ ДРАЙВЕРА
====================================

ПРОБЛЕМА
========
Драйвер был установлен, но не распознавался в системе. Причина: драйвер работал как фильтр и не создавал контрольное устройство для user-mode доступа.

РЕШЕНИЕ
=======
Обновленный драйвер теперь создает контрольное устройство с символической ссылкой \\DosDevices\\GyroMouseFilter, которое может быть открыто user-mode приложением.

ШАГИ ПЕРЕУСТАНОВКИ
==================

1. УДАЛИТЬ СТАРЫЙ ДРАЙВЕР
   - Открыть Device Manager (devmgmt.msc)
   - Найти устройство мыши с установленным GyroFilterDriver
   - Правый клик -> Удалить устройство
   - Отметить "Удалить программное обеспечение драйвера"
   - Нажать "Удалить"
   - Перезагрузить компьютер

2. СКОПИРОВАТЬ НОВЫЕ ФАЙЛЫ ДРАЙВЕРА
   - Скопировать следующие файлы из x64\Release\:
     * GyroFilterDriver.sys
     * GyroFilterDriver.inf
     * GyroFilterDriver\gyrofilterdriver.cat
   - Поместить их в одну папку

3. УСТАНОВИТЬ НОВЫЙ ДРАЙВЕР
   - Открыть Device Manager
   - Найти устройство мыши
   - Правый клик -> Обновить драйвер
   - Выбрать "Обзор компьютера для поиска драйверов"
   - Указать папку с новыми файлами драйвера
   - Нажать "Далее" и дождаться установки
   - Перезагрузить компьютер

4. ПРОВЕРИТЬ УСТАНОВКУ
   - Открыть Command Prompt как администратор
   - Выполнить: dir \\.\GyroMouseFilter
   - Если устройство найдено, установка успешна

ИСПОЛЬЗОВАНИЕ ОБНОВЛЕННОГО ДРАЙВЕРА
====================================

Теперь user-mode приложение может открыть устройство:

1. СКОМПИЛИРОВАТЬ ПРИЛОЖЕНИЕ
   - Перейти в папку GyroMouseFilterControl
   - Выполнить: cl GyroMouseFilterControl.c /link user32.lib

2. ЗАПУСТИТЬ КОМАНДЫ
   - Включить фильтрацию:
     GyroMouseFilterControl.exe enable-filter
   
   - Установить порог:
     GyroMouseFilterControl.exe set-threshold 10
   
   - Блокировать ввод:
     GyroMouseFilterControl.exe block-input
   
   - Разблокировать ввод:
     GyroMouseFilterControl.exe unblock-input
   
   - Получить информацию:
     GyroMouseFilterControl.exe get-info

ОТЛАДКА
=======

Если приложение все еще не может открыть устройство:

1. Проверить, что драйвер установлен:
   - Device Manager -> Мышь и другие указывающие устройства
   - Должен быть GyroFilterDriver

2. Проверить символическую ссылку:
   - Command Prompt (администратор):
     dir \\.\GyroMouseFilter
   - Если ошибка, переустановить драйвер

3. Просмотреть отладочные сообщения:
   - Запустить DebugView.exe
   - Выполнить команду управления
   - Проверить сообщения в DebugView

4. Проверить права доступа:
   - Запустить Command Prompt как администратор
   - Попробовать выполнить команду управления

НОВЫЕ ВОЗМОЖНОСТИ
=================

✅ Драйвер теперь создает контрольное устройство
✅ User-mode приложение может открыть устройство
✅ Все IOCTL команды работают через контрольное устройство
✅ Фильтрация позиции мыши работает корректно

ФАЙЛЫ
=====

Обновленные файлы:
- driver.c - Добавлена функция GyroMouseCreateControlDevice()
- driver.h - Добавлена структура CONTROL_DEVICE_CONTEXT
- GyroFilterDriver.vcxproj - Без изменений

Скомпилированный драйвер:
- x64\Release\GyroFilterDriver.sys

КОНТАКТЫ
========

Для вопросов обратитесь к документации в папке проекта.

Дата обновления: 23 января 2026
